<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Delivery Overview üì¶</title>
  <style>
    :root{
      --bg:#ffffff;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;

      --primary:#2563eb;
      --primary2:#1d4ed8;

      --ok:#16a34a;
      --warn:#d97706;
      --bad:#dc2626;

      --soft:#f8fafc;
      --soft2:#f1f5f9;
      --shadow: 0 10px 30px rgba(15,23,42,.07);
      --radius:14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(180deg,#ffffff 0%, #f6f7fb 100%);
      color:var(--text);
    }

    .wrap{
      max-width:1200px;
      margin:24px auto 64px;
      padding:0 18px;
    }

    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
      padding:6px 2px 14px;
    }
    header h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    header .sub{
      color:var(--muted);
      font-size:13px;
      margin-top:4px;
    }

    .grid{
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:16px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }

    .card h2{
      margin:0 0 12px;
      font-size:16px;
    }

    .row{display:flex; gap:10px; align-items:center}
    .row.wrap{flex-wrap:wrap}

    .field{margin:10px 0}
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
    }
    input, select, textarea{
      width:100%;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      font-size:14px;
      background:var(--soft);
      color:var(--text);
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color:#b8cdfc;
      box-shadow:0 0 0 3px rgba(37,99,235,.12);
    }
    textarea{min-height:140px; resize:vertical}

    .btnbar{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:0;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      font-size:14px;
      background:var(--primary);
      color:#fff;
      box-shadow:0 8px 20px rgba(37,99,235,.18);
    }
    button:hover{background:var(--primary2)}
    button.secondary{
      background:#e5e7eb;
      color:#111827;
      box-shadow:none;
    }
    button.secondary:hover{background:#d1d5db}
    button.ghost{
      background:transparent;
      color:var(--primary2);
      box-shadow:none;
      border:1px solid #cfe0ff;
    }
    button.ghost:hover{background:#eef5ff}

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:#0f172a;
      background:#eef5ff;
      border:1px solid #cfe0ff;
      padding:6px 10px;
      border-radius:999px;
    }

    .muted{color:var(--muted); font-size:12px}
    .sep{height:1px; background:var(--border); margin:12px 0}

    /* Templates */
    .templateCard{
      border:1px solid var(--border);
      background:linear-gradient(180deg, #ffffff 0%, #fbfcff 100%);
      border-radius:14px;
      padding:14px;
    }
    .templateTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .templateTitle{
      font-weight:700;
      font-size:14px;
    }
    .templateActions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .templateActions button{
      padding:8px 10px;
      font-size:13px;
      border-radius:12px;
      box-shadow:none;
    }
    .templateActions button.secondary{
      border:1px solid var(--border);
    }

    textarea[disabled]{
      background:var(--soft2);
      color:#475569;
    }

    /* Mail log accordion */
    details{
      border:1px solid var(--border);
      border-radius:14px;
      background:#ffffff;
      overflow:hidden;
    }
    details summary{
      cursor:pointer;
      padding:12px 14px;
      list-style:none;
      font-weight:700;
      user-select:none;
    }
    details summary::-webkit-details-marker{display:none}
    .logBody{
      padding:0 14px 14px;
    }
    .logBox{
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      background:var(--soft);
      max-height:240px;
      overflow:auto;
      white-space:pre-wrap; /* keeps text inside the box */
      word-break:break-word;
      font-size:13px;
      color:#334155;
    }

    /* Supplier KEY text under supplier should be hidden, but functions remain */
    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Delivery Overview üì¶</h1>
        <div class="sub">Orders, templates, and mail logging</div>
      </div>
      <div class="pill" id="statusPill">‚óè Ready</div>
    </header>

    <div class="grid">
      <!-- LEFT: NEW ORDER -->
      <section class="card">
        <h2>New order</h2>

        <div class="field">
          <label for="orderId">Order ID</label>
          <input id="orderId" placeholder="e.g. 1000123" />
        </div>

        <div class="field">
          <label for="customerEmail">Customer email</label>
          <input id="customerEmail" placeholder="customer@email.com" />
        </div>

        <div class="field">
          <label for="supplierSelect">Supplier</label>
          <select id="supplierSelect"></select>

          <!-- ‚úÖ TEXT REMOVED: "Supplier KEY: FONE26" (hidden, but key still available via supplierKeyHidden) -->
          <div id="supplierKeyText" class="muted hidden">Supplier KEY: <span id="supplierKeyValue">FONE26</span></div>
          <input id="supplierKeyHidden" class="hidden" value="FONE26" />
        </div>

        <div class="btnbar">
          <button onclick="addNewOrder()">Add new order</button>
          <button class="secondary" onclick="clearNewOrder()">Clear</button>
        </div>

        <div class="sep"></div>
        <div class="muted">
          Tip: supplier key is stored internally (hidden) so everything keeps working.
        </div>
      </section>

      <!-- RIGHT: ORDER DETAILS + TEMPLATES + LOG -->
      <section class="card">
        <div class="row" style="justify-content:space-between; gap:12px; flex-wrap:wrap;">
          <h2 style="margin:0">Order details</h2>
          <div class="row" style="gap:10px; flex-wrap:wrap;">
            <input id="searchOrder" placeholder="Search order id‚Ä¶" style="width:240px" />
            <button class="ghost" onclick="loadOrder()">Load</button>
          </div>
        </div>

        <div class="sep"></div>

        <div class="row wrap">
          <div style="flex:1; min-width:260px">
            <div class="field">
              <label>Selected order</label>
              <input id="selectedOrder" disabled value="(none)" />
            </div>
          </div>

          <div style="flex:1; min-width:260px">
            <div class="field">
              <label>Supplier</label>
              <input id="selectedSupplier" disabled value="-" />
            </div>
          </div>
        </div>

        <div class="row wrap">
          <div style="flex:1; min-width:260px">
            <div class="field">
              <label>Supplier template</label>
              <input id="supplierTemplateName" disabled value="Supplier" />
            </div>
          </div>

          <div style="flex:1; min-width:260px">
            <div class="field">
              <label>Supplier KEY</label>
              <input id="supplierKeyDetails" disabled value="-" />
            </div>
          </div>
        </div>

        <div class="sep"></div>

        <!-- TEMPLATES -->
        <div class="row" style="justify-content:space-between; align-items:flex-end">
          <h2 style="margin:0">Mail templates</h2>
          <div class="muted">Edit + Save + Stop editing</div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px">
          <!-- Edit mail customer -->
          <div class="templateCard">
            <div class="templateTop">
              <div class="templateTitle">Edit mail customer</div>
              <div class="templateActions">
                <button id="custEditBtn" onclick="startEditTemplate('cust')">Edit</button>
                <button id="custSaveBtn" onclick="saveTemplate('cust')" style="display:none">Save</button>
                <button id="custCancelBtn" class="secondary" onclick="cancelEditTemplate('cust')" style="display:none">Stop editing</button>
                <!-- ‚úÖ SEND BUTTON REMOVED as requested -->
              </div>
            </div>
            <label for="custTemplate">Template</label>
            <textarea id="custTemplate" disabled>
Hi {{customer_name}},

Your order {{order_id}} has been received and is being processed.

Thank you!
            </textarea>
          </div>

          <!-- Edit mail supplier -->
          <div class="templateCard">
            <div class="templateTop">
              <div class="templateTitle">Edit mail supplier</div>
              <div class="templateActions">
                <button id="suppEditBtn" onclick="startEditTemplate('supp')">Edit</button>
                <button id="suppSaveBtn" onclick="saveTemplate('supp')" style="display:none">Save</button>
                <button id="suppCancelBtn" class="secondary" onclick="cancelEditTemplate('supp')" style="display:none">Stop editing</button>
                <!-- ‚úÖ SEND BUTTON REMOVED as requested -->
              </div>
            </div>
            <label for="suppTemplate">Template</label>
            <textarea id="suppTemplate" disabled>
Dear Supplier,

Please ship order {{order_id}} to the customer.

Regards,
            </textarea>
          </div>
        </div>

        <div style="margin-top:12px" class="templateCard">
          <div class="templateTop">
            <div class="templateTitle">Dropshipment template</div>
            <div class="templateActions">
              <button id="dropEditBtn" onclick="startEditTemplate('drop')">Edit</button>
              <button id="dropSaveBtn" onclick="saveTemplate('drop')" style="display:none">Save</button>
              <button id="dropCancelBtn" class="secondary" onclick="cancelEditTemplate('drop')" style="display:none">Stop editing</button>
            </div>
          </div>
          <label for="dropTemplate">Template</label>
          <textarea id="dropTemplate" disabled>
Dear Supplier,

Please ship the following order directly to the customer.

Order number: {{order_id}}
Customer name: {{customer_name}}
Address: {{address}}

Thank you.
          </textarea>
        </div>

        <div class="sep"></div>

        <!-- MAIL LOG -->
        <details open>
          <summary>Mail log</summary>
          <div class="logBody">
            <div class="logBox" id="mailLogBox">(no logs yet)</div>
            <div class="btnbar" style="margin-top:10px">
              <button class="secondary" onclick="clearLog()">Clear log</button>
            </div>
          </div>
        </details>

      </section>
    </div>
  </div>

<script>
/* =========================
   STATE / DEMO DATA
========================= */
const suppliers = [
  { name: "Fone", key: "FONE26" },
  { name: "Supplier B", key: "SUPB01" },
  { name: "Supplier C", key: "SUPC99" }
];

const templateState = {
  cust: { original: "" },
  supp: { original: "" },
  drop: { original: "" }
};

function logLine(msg){
  const box = document.getElementById("mailLogBox");
  const ts = new Date().toLocaleString();
  const next = (box.textContent === "(no logs yet)") ? "" : box.textContent + "\n";
  box.textContent = next + `[${ts}] ${msg}`;
}

/* =========================
   INIT
========================= */
(function init(){
  const sel = document.getElementById("supplierSelect");
  sel.innerHTML = suppliers.map((s, i) => `<option value="${i}">${escapeHtml(s.name)}</option>`).join("");

  sel.addEventListener("change", syncSupplierKey);
  syncSupplierKey();

  // capture initial originals
  templateState.cust.original = document.getElementById("custTemplate").value;
  templateState.supp.original = document.getElementById("suppTemplate").value;
  templateState.drop.original = document.getElementById("dropTemplate").value;

  logLine("UI loaded.");
})();

function syncSupplierKey(){
  const idx = Number(document.getElementById("supplierSelect").value || 0);
  const s = suppliers[idx] || suppliers[0];

  // keep key for logic (hidden), but don't show the old text
  document.getElementById("supplierKeyHidden").value = s.key;
  document.getElementById("supplierKeyValue").textContent = s.key;

  // IMPORTANT: Supplier KEY text stays hidden (as requested)
  document.getElementById("supplierKeyText").classList.add("hidden");
}

/* =========================
   NEW ORDER
========================= */
function addNewOrder(){
  const orderId = document.getElementById("orderId").value.trim();
  const email = document.getElementById("customerEmail").value.trim();
  const supplierIdx = Number(document.getElementById("supplierSelect").value || 0);
  const supplier = suppliers[supplierIdx];
  const supplierKey = document.getElementById("supplierKeyHidden").value;

  if(!orderId){
    setStatus("Missing Order ID", "warn");
    return;
  }

  // Here you would call your Apps Script / backend:
  // google.script.run.withSuccessHandler(...).addOrder({orderId, email, supplier: supplier.name, supplierKey})
  // For now we just mirror into details:
  document.getElementById("selectedOrder").value = orderId;
  document.getElementById("selectedSupplier").value = supplier.name;
  document.getElementById("supplierKeyDetails").value = supplierKey;

  setStatus("Order added (UI)", "ok");
  logLine(`Added order ${orderId} (supplier ${supplier.name}, key stored).`);
}

function clearNewOrder(){
  document.getElementById("orderId").value = "";
  document.getElementById("customerEmail").value = "";
  document.getElementById("supplierSelect").value = "0";
  syncSupplierKey();
  setStatus("Cleared", "ok");
  logLine("Cleared new order form.");
}

/* =========================
   ORDER LOAD (stub)
========================= */
function loadOrder(){
  const q = document.getElementById("searchOrder").value.trim();
  if(!q){
    setStatus("Enter order id to load", "warn");
    return;
  }
  // Here you would load from backend:
  // google.script.run.withSuccessHandler(fillOrder).getOrder(q)

  // Demo fill:
  document.getElementById("selectedOrder").value = q;
  document.getElementById("selectedSupplier").value = suppliers[0].name;
  document.getElementById("supplierKeyDetails").value = suppliers[0].key;

  setStatus("Order loaded (demo)", "ok");
  logLine(`Loaded order ${q} (demo).`);
}

/* =========================
   TEMPLATE EDIT / SAVE / CANCEL
========================= */
function mapPrefix(which){
  if(which === "cust") return "cust";
  if(which === "supp") return "supp";
  return "drop";
}

function getEls(which){
  const p = mapPrefix(which);
  return {
    textarea: document.getElementById(p + "Template"),
    edit: document.getElementById(p + "EditBtn"),
    save: document.getElementById(p + "SaveBtn"),
    cancel: document.getElementById(p + "CancelBtn")
  };
}

function startEditTemplate(which){
  const els = getEls(which);
  templateState[which].original = els.textarea.value;

  els.textarea.disabled = false;
  els.textarea.focus();

  els.edit.style.display = "none";
  els.save.style.display = "inline-block";
  els.cancel.style.display = "inline-block";

  setStatus("Editing template‚Ä¶", "ok");
  logLine(`Started editing template: ${which}`);
}

function cancelEditTemplate(which){
  const els = getEls(which);
  els.textarea.value = templateState[which].original;
  els.textarea.disabled = true;

  els.edit.style.display = "inline-block";
  els.save.style.display = "none";
  els.cancel.style.display = "none";

  setStatus("Edit cancelled", "ok");
  logLine(`Cancelled editing template: ${which}`);
}

function saveTemplate(which){
  const els = getEls(which);
  const value = els.textarea.value;

  els.textarea.disabled = true;
  els.edit.style.display = "inline-block";
  els.save.style.display = "none";
  els.cancel.style.display = "none";

  // Backend call placeholder:
  // google.script.run.withSuccessHandler(() => {
  //   setStatus("Template saved", "ok");
  //   logLine(`Saved template: ${which}`);
  // }).withFailureHandler(err => {
  //   setStatus("Save failed", "bad");
  //   logLine(`Save failed (${which}): ${err}`);
  // }).saveTemplate(which, value);

  setStatus("Template saved (UI)", "ok");
  logLine(`Saved template (UI): ${which}`);
}

/* =========================
   LOG
========================= */
function clearLog(){
  document.getElementById("mailLogBox").textContent = "(no logs yet)";
  setStatus("Log cleared", "ok");
}

/* =========================
   STATUS
========================= */
function setStatus(text, type){
  const pill = document.getElementById("statusPill");
  pill.textContent = "‚óè " + text;

  // keep styling minimal; we don't set colors via classes, just text
  // (your existing styling can be added here if you want)
}

/* =========================
   HELPERS
========================= */
function escapeHtml(str){
  return (str ?? "").replace(/[&<>"']/g, (m) => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}
</script>

</body>
</html>
